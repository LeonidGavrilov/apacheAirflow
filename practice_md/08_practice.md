# Финальное задание: Создание взаимосвязанных DAG'ов и использование XCom в Airflow

## Задание 1: Генерация случайного числа и запись в S3

1. Создайте DAG, который выполняет следующие действия:
   1. Использует макрос для генерации случайного числа.
   2. Записывает это число в файл на S3. Название файла должно быть уникальным и содержать вашу фамилию (получите фамилию из переменной окружения Airflow по ключу). Ключ можете написать вручную в коде дага, он заранее известен. Пример: `random_number_kartashov.txt`.
   3. даг должен запускаться 5 числа каждого месяца в 13 45, начиная с апреля 2024
      * `название коннекшна до s3 = yandexS3`
      * `путь, по которому нужно положить файл = airf_bds/work_dir/students/<ваша фамилия>/random_number_<ваша фамилия>.txt`
      * `подсказка: используйте python оператор с входными параметрами (фамилия и число)`


## Задание 2: Проверка выполнения первого DAG и обработка данных

1. Создайте второй DAG, который выполняет следующие действия:
   1. Использует Dataset для проверки, был ли выполнен первый DAG и создан файл на S3.
   2. Читает содержимое файла, который был создан первым DAG, и пушит это число в XCom с ключом `bank_account_<ваша_фамилия>`, можно писать вручную фамилию в ф-ии.
   3. Проверяет наличие таблицы `final_practice` в PostgreSQL с помощью sql сенсора:
      - Если таблица существует:
        - С помощью PostgresOperator: 
            - извлекает данные из XCom и записывает в таблицу следующую информацию
            (Нужно использовать PostgresOperator и сделать всего один запрос, в котором с помощью templates вы подставите необходимые значения)
            - `id` (Ваш ключ из Variables("students")), прописывается вручную в SQL запросе.
            - `name` (получается из Variables по ключу), используется templates.
            - `bank_account` (получается из XCom с помощью templates).
            - `time_key` (минус 7 дней от даты выполнения DAG run), используется шаблон.
   4. Использует хук для получения самого большого значения `bank_account` из таблицы `final_practice` и выполняет с ним дополнительное действие по вашему выбору (например, проверяет его на четность или просто печатает на экран).

